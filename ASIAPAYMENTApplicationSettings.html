<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIAPAYMENT Application Settings</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* [Previous CSS remains the same until .color-input] */
        
        .color-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .color-input input[type="text"] {
            flex: 1;
        }
        .rgb-inputs {
            display: flex;
            gap: 5px;
        }
        .rgb-inputs input {
            width: 60px;
            text-align: center;
        }
        .rgb-sliders {
            width: 100%;
            margin-top: 5px;
        }
        .rgb-sliders input[type="range"] {
            width: 100%;
        }
        .color-preview-box {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* [Rest of previous CSS remains the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same until color settings table] -->
    
    <div class="settings-section">
        <h2>Color Settings (RGB Format)</h2>
        <table id="colorSettingsTable">
            <thead>
                <tr>
                    <th width="25%">Element</th>
                    <th width="55%">RGB Color Value</th>
                    <th width="20%">Action</th>
                </tr>
            </thead>
            <tbody id="colorSettingsBody">
                <!-- Color settings will be added here -->
            </tbody>
        </table>
    </div>

    <!-- [Rest of previous HTML remains the same] -->

    <script>
        // [Previous Firebase configuration remains the same]

        // Color settings configuration - now with RGB defaults
        const colorSettings = [
            { key: "appNameColor", name: "App Name Color", cssVar: "--app-name-color", default: "44, 62, 80" },       // #2c3e50
            { key: "taglineColor", name: "Tagline Color", cssVar: "--tagline-color", default: "127, 140, 141" },      // #7f8c8d
            { key: "buttonColor", name: "Primary Button", cssVar: "--button-color", default: "52, 152, 219" },        // #3498db
            { key: "secondaryButton", name: "Secondary Button", cssVar: "--secondary-button", default: "46, 204, 113" }, // #2ecc71
            { key: "textColor", name: "Text Color", cssVar: "--text-color", default: "51, 51, 51" }                   // #333333
        ];

        // Helper functions for RGB conversion and validation
        function hexToRgb(hex) {
            // Remove # if present
            hex = hex.replace('#', '');
            
            // Parse r, g, b values
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return `${r}, ${g}, ${b}`;
        }

        function rgbToHex(rgb) {
            // Extract r, g, b values
            const [r, g, b] = rgb.split(',').map(val => parseInt(val.trim()));
            
            // Convert to hex
            const toHex = (c) => {
                const hex = c.toString(16);
                return hex.length === 1 ? "0" + hex : hex;
            };
            
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }

        function isValidRgb(rgb) {
            const regex = /^\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*$/;
            if (!regex.test(rgb)) return false;
            
            const [r, g, b] = rgb.split(',').map(val => parseInt(val.trim()));
            return r >= 0 && r <= 255 && 
                   g >= 0 && g <= 255 && 
                   b >= 0 && b <= 255;
        }

        // Function to create RGB input field
        function createRgbInputField(setting, value) {
            const container = document.createElement('div');
            container.className = 'color-input';
            
            // Parse current RGB value or use default
            let [r, g, b] = (value || setting.default).split(',').map(v => parseInt(v.trim()));
            
            // Create RGB text inputs
            const rgbInputs = document.createElement('div');
            rgbInputs.className = 'rgb-inputs';
            
            const rInput = document.createElement('input');
            rInput.type = 'text';
            rInput.placeholder = 'R';
            rInput.value = r;
            rInput.dataset.channel = 'r';
            
            const gInput = document.createElement('input');
            gInput.type = 'text';
            gInput.placeholder = 'G';
            gInput.value = g;
            gInput.dataset.channel = 'g';
            
            const bInput = document.createElement('input');
            bInput.type = 'text';
            bInput.placeholder = 'B';
            bInput.value = b;
            bInput.dataset.channel = 'b';
            
            rgbInputs.appendChild(rInput);
            rgbInputs.appendChild(gInput);
            rgbInputs.appendChild(bInput);
            
            // Create color preview box
            const previewBox = document.createElement('div');
            previewBox.className = 'color-preview-box';
            previewBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
            
            // Create RGB sliders
            const slidersContainer = document.createElement('div');
            slidersContainer.className = 'rgb-sliders';
            
            const rSlider = document.createElement('input');
            rSlider.type = 'range';
            rSlider.min = '0';
            rSlider.max = '255';
            rSlider.value = r;
            rSlider.dataset.channel = 'r';
            
            const gSlider = document.createElement('input');
            gSlider.type = 'range';
            gSlider.min = '0';
            gSlider.max = '255';
            gSlider.value = g;
            gSlider.dataset.channel = 'g';
            
            const bSlider = document.createElement('input');
            bSlider.type = 'range';
            bSlider.min = '0';
            bSlider.max = '255';
            bSlider.value = b;
            bSlider.dataset.channel = 'b';
            
            slidersContainer.appendChild(rSlider);
            slidersContainer.appendChild(gSlider);
            slidersContainer.appendChild(bSlider);
            
            // Update function
            const updateColor = () => {
                r = parseInt(rInput.value) || 0;
                g = parseInt(gInput.value) || 0;
                b = parseInt(bInput.value) || 0;
                
                // Clamp values
                r = Math.min(255, Math.max(0, r));
                g = Math.min(255, Math.max(0, g));
                b = Math.min(255, Math.max(0, b));
                
                // Update inputs
                rInput.value = r;
                gInput.value = g;
                bInput.value = b;
                
                // Update sliders
                rSlider.value = r;
                gSlider.value = g;
                bSlider.value = b;
                
                // Update preview
                previewBox.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                
                return `${r}, ${g}, ${b}`;
            };
            
            // Event listeners for text inputs
            [rInput, gInput, bInput].forEach(input => {
                input.addEventListener('input', () => {
                    const rgbString = updateColor();
                    document.getElementById(`rgb_${setting.key}`).value = rgbString;
                });
            });
            
            // Event listeners for sliders
            [rSlider, gSlider, bSlider].forEach(slider => {
                slider.addEventListener('input', () => {
                    const channel = slider.dataset.channel;
                    if (channel === 'r') rInput.value = slider.value;
                    if (channel === 'g') gInput.value = slider.value;
                    if (channel === 'b') bInput.value = slider.value;
                    const rgbString = updateColor();
                    document.getElementById(`rgb_${setting.key}`).value = rgbString;
                });
            });
            
            // Hidden input to store the RGB string
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.id = `rgb_${setting.key}`;
            hiddenInput.value = `${r}, ${g}, ${b}`;
            
            container.appendChild(rgbInputs);
            container.appendChild(previewBox);
            container.appendChild(slidersContainer);
            container.appendChild(hiddenInput);
            
            return container;
        }

        // Modified applyColorSettings function for RGB
        function applyColorSettings() {
            colorSettingsRef.once('value').then((snapshot) => {
                const colors = snapshot.val() || {};
                
                colorSettings.forEach(setting => {
                    const rgbValue = colors[setting.key] || setting.default;
                    document.documentElement.style.setProperty(
                        setting.cssVar, 
                        `rgb(${rgbValue})`
                    );
                });
            });
        }

        // Modified createColorSettingsTable for RGB
        function createColorSettingsTable() {
            const tableBody = document.getElementById('colorSettingsBody');
            
            colorSettingsRef.once('value').then((snapshot) => {
                const colors = snapshot.val() || {};
                
                colorSettings.forEach(setting => {
                    const row = document.createElement('tr');
                    
                    // Setting name cell
                    const nameCell = document.createElement('td');
                    nameCell.textContent = setting.name;
                    row.appendChild(nameCell);
                    
                    // Value input cell
                    const valueCell = document.createElement('td');
                    const inputContainer = createRgbInputField(
                        setting, 
                        colors[setting.key]
                    );
                    valueCell.appendChild(inputContainer);
                    row.appendChild(valueCell);
                    
                    // Save button cell
                    const actionCell = document.createElement('td');
                    const saveButton = document.createElement('button');
                    saveButton.className = 'save-btn';
                    saveButton.textContent = 'Save';
                    saveButton.onclick = () => {
                        const rgbString = document.getElementById(`rgb_${setting.key}`).value;
                        if (isValidRgb(rgbString)) {
                            updateColorSetting(setting.key, rgbString);
                        } else {
                            showStatus('Please enter valid RGB values (0-255 for each channel)', false);
                        }
                    };
                    actionCell.appendChild(saveButton);
                    row.appendChild(actionCell);
                    
                    tableBody.appendChild(row);
                });
                
                // Apply initial color settings
                applyColorSettings();
            }).catch((error) => {
                showStatus(`Error loading color settings: ${error.message}`, false);
            });
        }

        // [Rest of the JavaScript code remains the same]
    </script>
</body>
</html>
